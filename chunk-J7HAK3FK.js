import{v}from"./chunk-GOJ2ZNOE.js";import{R as h,V as f,a as m,b as g,f as l}from"./chunk-QQS62GLD.js";var b=class y{constructor(r){this.http=r;let a=document.getElementsByTagName("base")[0],i=a&&a.getAttribute("href")||"/";this.base=i.endsWith("/")?`${i}assets/data/events`:`${i}/assets/data/events`}base;fetchJson(r){return l(this,null,function*(){try{let a=yield fetch(`${this.base}/${r}`);return a.ok?a.json():null}catch(a){return console.error("fetchJson error",r,a),null}})}listAll(){return l(this,null,function*(){let[r,a,i]=yield Promise.all([this.fetchJson("metrics_comparison.json"),this.fetchJson("videos_2024_onwards.json"),this.fetchJson("videos_pre_2024.json")]),s=[];Array.isArray(i)&&s.push(...i),Array.isArray(a)&&s.push(...a);let t=s.map(c=>{let d=c.data_postagem??c.date??c.day??null,o=null;if(d)try{o=new Date(d),isNaN(o.getTime())&&(o=null)}catch{o=null}return g(m({},c),{data_postagem:d,parsedDate:o})}).filter(c=>c.parsedDate),n=this.aggregateByPeriod(t,"month"),p=this.aggregateByPeriod(t,"year");return{videos:t,metrics:Array.isArray(r)?r:[],videosByMonth:n,videosByYear:p}})}aggregateByPeriod(r,a){let i={};for(let s of r){if(!s.parsedDate)continue;let t;a==="month"?t=`${s.parsedDate.getFullYear()}-${String(s.parsedDate.getMonth()+1).padStart(2,"0")}`:t=String(s.parsedDate.getFullYear()),i[t]=(i[t]||0)+1}return Object.entries(i).map(([s,t])=>({period:s,count:t})).sort((s,t)=>s.period.localeCompare(t.period))}getAllVideos(){return l(this,null,function*(){return(yield this.listAll()).videos})}getMetrics(){return l(this,null,function*(){return(yield this.listAll()).metrics})}getVideosByMonth(){return l(this,null,function*(){return(yield this.listAll()).videosByMonth})}getVideosByYear(){return l(this,null,function*(){return(yield this.listAll()).videosByYear})}getEventsRaw(){return this.http.get("assets/data/events.json")}getEventsTimeSeries(){return this.http.get("assets/data/events_timeseries.json")}getEvaluationsOverview(){return l(this,null,function*(){let{videos:r,metrics:a,videosByYear:i}=yield this.listAll(),s=r?.length??0,t=r?new Set(r.map(e=>e.operation_id||e.operation||e.op)).size:0,n=(r??[]).map(e=>e.parsedDate?.getFullYear?.()).filter(e=>typeof e=="number"&&!isNaN(e)),p=n.length?`${Math.min(...n)}\u2013${Math.max(...n)}`:"\u2014",c=t?+(s/t).toFixed(1):0,d=Array.isArray(a)&&a.length?a.map(e=>({label:e.tecnica??e.label??e.nome??e.tech??"T\xE9cnica",metrics:{accuracy:e.accuracy??e.acuracia??e.acu??0,precision:e.precision??e.pre??0,recall:e.recall??e.rev??e.revocacao??0,f1:e.f1??0}})):[],o={labels:(i??[]).map(e=>e.period),values:(i??[]).map(e=>e.count)};return{datasets:{totalVideos:s,uniqueOperations:t,periodLabel:p,avgVideosPerOperation:c},performance:d,videosByPeriod:o}})}buildSeriesFromRaw(r){let a={};(r.videos??r).forEach(t=>{let n=new Date(t.date||t.created_at||t.timestamp).getFullYear();isNaN(n)||(a[n]=(a[n]||0)+1)});let i=Object.keys(a).sort(),s=i.map(t=>a[+t]);return{labels:i,values:s}}getOperationVideos(r){return l(this,null,function*(){let{videos:a}=yield this.listAll(),i=String(r).trim().toLowerCase();return a.filter(s=>{let t=(s.operation_id??s.operation??s.op??"").toString().trim().toLowerCase();return t&&t===i})})}getOperationOverview(r){return l(this,null,function*(){let a=yield this.getOperationVideos(r),i=a.length,s={},t=null,n=null;for(let o of a){let e=o.parsedDate??(o.data_postagem?new Date(o.data_postagem):null);if(!e||isNaN(e.getTime()))continue;let u=e.toISOString().slice(0,10);s[u]=(s[u]||0)+1,(!t||e<t)&&(t=e),(!n||e>n)&&(n=e)}let p=Object.keys(s).sort(),c=p.map(o=>s[o]),d=t&&n?`${t.toISOString().slice(0,10)} \u2013 ${n.toISOString().slice(0,10)}`:"\u2014";return{opId:String(r),totalVideos:i,periodLabel:d,videosByDay:{labels:p,values:c}}})}static \u0275fac=function(a){return new(a||y)(f(v))};static \u0275prov=h({token:y,factory:y.\u0275fac,providedIn:"root"})};export{b as a};
