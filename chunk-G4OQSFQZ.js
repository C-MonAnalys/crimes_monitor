import{a as ee,b as te,c as ne,g as ie,h as ae}from"./chunk-Q67L2CHF.js";import{l as X,m as $}from"./chunk-MWBKWIFM.js";import{a as re}from"./chunk-XXFZ6NT5.js";import{d as Q}from"./chunk-IAGVYY6L.js";import{a as oe}from"./chunk-Q6ESINKT.js";import{j as Z,k as q,l as z,m as G,n as J,o as K}from"./chunk-GOJ2ZNOE.js";import{$ as u,Aa as s,Ab as W,Db as b,Eb as v,Fb as y,Gb as j,La as A,Nb as S,Ob as B,Pb as H,Qa as f,Qb as U,Rb as I,W as O,a as M,aa as g,b as L,bb as m,cb as o,db as a,eb as F,f as P,ib as C,jb as D,kb as N,nb as x,ob as p,tb as T,ya as Y,yb as d,zb as _}from"./chunk-QQS62GLD.js";function se(r,l){if(r&1&&(o(0,"span",12),d(1),a()),r&2){let e=p();s(),W("(",e.meta.label,")")}}function de(r,l){r&1&&(o(0,"div",4),d(1,"Carregando\u2026"),a())}function pe(r,l){if(r&1&&(o(0,"div",13),d(1),a()),r&2){let e=p();s(),_(e.error)}}function ce(r,l){r&1&&(o(0,"div",14),d(1,"Conex\xE3o lenta. Exibindo o que j\xE1 foi carregado\u2026"),a())}function me(r,l){if(r&1&&(C(0),F(1,"p-chart",28),D()),r&2){let e=p(2);s(),m("data",e.yearChart)("options",e.yearOpts)}}function ue(r,l){r&1&&(o(0,"div",29),d(1,"Sem s\xE9rie por ano."),a())}function ge(r,l){if(r&1&&(C(0),F(1,"p-chart",28),D()),r&2){let e=p(2);s(),m("data",e.dayChart)("options",e.dayOpts)}}function _e(r,l){r&1&&(o(0,"div",29),d(1,"Sem s\xE9rie por dia."),a())}function he(r,l){if(r&1&&(o(0,"a",45),d(1,"Abrir v\xEDdeo"),a()),r&2){let e=p().$implicit;m("href",e.link||e.url,Y)}}function fe(r,l){if(r&1&&(o(0,"article",37)(1,"div",38),d(2),S(3,"date"),a(),o(4,"div",39),d(5),a(),o(6,"div",40),d(7),a(),o(8,"div",41)(9,"span",42),d(10),a()(),o(11,"div",43),f(12,he,2,1,"a",44),a()()),r&2){let e=l.$implicit;s(2),_(e.data_postagem||(e.parsedDate?H(3,7,e.parsedDate,"yyyy-MM-dd HH:mm"):"\u2014")),s(3),_(e.titulo||"Sem t\xEDtulo"),s(),m("title",j(e.descricao||"")),s(),_(e.descricao||"Sem descri\xE7\xE3o"),s(3),W("Opera\xE7\xE3o: ",e.operation_id||"\u2014"),s(2),m("ngIf",e.link||e.url)}}function xe(r,l){if(r&1){let e=N();C(0),o(1,"div",30)(2,"div",31)(3,"label",32),d(4,"Buscar por t\xEDtulo ou descri\xE7\xE3o"),a(),o(5,"input",33),y("ngModelChange",function(t){u(e);let n=p(2);return v(n.searchTerm,t)||(n.searchTerm=t),g(t)}),x("input",function(){u(e);let t=p(2);return g(t.applyFilters())}),a()(),o(6,"div")(7,"label",32),d(8,"Per\xEDodo (in\xEDcio)"),a(),o(9,"input",34),y("ngModelChange",function(t){u(e);let n=p(2);return v(n.startDate,t)||(n.startDate=t),g(t)}),x("input",function(){u(e);let t=p(2);return g(t.applyFilters())}),a()(),o(10,"div")(11,"label",32),d(12,"Per\xEDodo (fim)"),a(),o(13,"input",34),y("ngModelChange",function(t){u(e);let n=p(2);return v(n.endDate,t)||(n.endDate=t),g(t)}),x("input",function(){u(e);let t=p(2);return g(t.applyFilters())}),a()()(),o(14,"div",35),f(15,fe,13,10,"article",36),S(16,"slice"),a(),D()}if(r&2){let e=p(2);s(5),b("ngModel",e.searchTerm),s(4),b("ngModel",e.startDate),s(4),b("ngModel",e.endDate),s(2),m("ngForOf",U(16,4,e.filteredVideos,0,20))}}function be(r,l){r&1&&(o(0,"div",29),d(1,"Nenhum v\xEDdeo encontrado."),a())}function ve(r,l){if(r&1){let e=N();C(0),o(1,"section",15)(2,"div",16)(3,"div",17),d(4,"Total de V\xEDdeos"),a(),o(5,"div",18),d(6),S(7,"number"),a()(),o(8,"div",16)(9,"div",17),d(10,"Opera\xE7\xF5es \xDAnicas"),a(),o(11,"div",18),d(12),S(13,"number"),a()(),o(14,"div",16)(15,"div",17),d(16,"Per\xEDodo"),a(),o(17,"div",18),d(18),a()(),o(19,"div",16)(20,"div",17),d(21,"Dataset"),a(),o(22,"div",19),d(23),a()()(),o(24,"section")(25,"div",20)(26,"div",4)(27,"h2",21),d(28,"V\xEDdeos por ano"),a(),f(29,me,2,2,"ng-container",22)(30,ue,2,0,"ng-template",null,0,I),a(),o(32,"div",23)(33,"div",24)(34,"h2",25),d(35,"V\xEDdeos por dia"),a(),o(36,"div",26)(37,"input",27),y("ngModelChange",function(t){u(e);let n=p();return v(n.chartStartDate,t)||(n.chartStartDate=t),g(t)}),x("change",function(){u(e);let t=p();return g(t.applyChartRange())}),a(),o(38,"input",27),y("ngModelChange",function(t){u(e);let n=p();return v(n.chartEndDate,t)||(n.chartEndDate=t),g(t)}),x("change",function(){u(e);let t=p();return g(t.applyChartRange())}),a()()(),f(39,ge,2,2,"ng-container",22)(40,_e,2,0,"ng-template",null,1,I),a()()(),o(42,"section",4)(43,"h2",21),d(44,"Amostra de V\xEDdeos"),a(),f(45,xe,17,8,"ng-container",22)(46,be,2,0,"ng-template",null,2,I),a(),D()}if(r&2){let e=T(31),i=T(41),t=T(47),n=p();s(6),_(B(7,12,n.meta==null?null:n.meta.totalVideos)),s(6),_(B(13,14,n.meta==null?null:n.meta.totalOperations)),s(6),_((n.meta==null?null:n.meta.period)||"\u2014"),s(5),_(n.meta==null?null:n.meta.id),s(6),m("ngIf",n.yearChart==null||n.yearChart.labels==null?null:n.yearChart.labels.length)("ngIfElse",e),s(8),b("ngModel",n.chartStartDate),s(),b("ngModel",n.chartEndDate),s(),m("ngIf",n.dayChart==null||n.dayChart.labels==null?null:n.dayChart.labels.length)("ngIfElse",i),s(6),m("ngIf",n.filteredVideos==null?null:n.filteredVideos.length)("ngIfElse",t)}}var le=class r{route=O(Q);real=O(re);isLoading=!0;timedOut=!1;error="";datasetId="";meta=null;videos=[];yearChart;yearOpts;dayChart;dayOpts;baseDayLabels=[];baseDayValues=[];chartStartDate="";chartEndDate="";searchTerm="";selectedOperation="";startDate="";endDate="";filteredVideos=[];topOperations=[];ngOnInit(){return P(this,null,function*(){this.datasetId=this.route.snapshot.paramMap.get("id")||"";let l=this.real.loadDataset(this.datasetId);try{let e=yield oe(l,5e3);this.apply(e)}catch(e){e?.message==="TIMEOUT"?(this.timedOut=!0,this.isLoading=!1,l.then(i=>this.apply(i)).catch(()=>{this.error="N\xE3o foi poss\xEDvel carregar o dataset."})):(this.error="N\xE3o foi poss\xEDvel carregar o dataset.",this.isLoading=!1)}})}apply(l){this.meta=l.meta,this.videos=l.videos,this.filteredVideos=this.videos;let e={};for(let i of this.videos){let t=(i.operation_id??i.operation??"unknown").toString();e[t]=(e[t]||0)+1}if(this.topOperations=Object.entries(e).map(([i,t])=>({operation:i,count:t})).sort((i,t)=>t.count-i.count).slice(0,50),this.yearChart={labels:l.series.byYear.labels,datasets:[{label:"V\xEDdeos por ano",data:l.series.byYear.values,borderColor:"#0ea5e9",backgroundColor:"#0ea5e933",pointBackgroundColor:"#0ea5e9",pointBorderColor:"#ffffff",pointRadius:3,pointHoverRadius:6,tension:.35,fill:!0}]},this.yearOpts={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}},elements:{point:{radius:3,hoverRadius:6}},scales:{y:{beginAtZero:!0}}},this.baseDayLabels=l.series.byDay.labels||[],this.baseDayValues=l.series.byDay.values||[],this.dayChart={labels:this.baseDayLabels,datasets:[{label:"V\xEDdeos por dia",data:this.baseDayValues,borderColor:"#0ea5e9",backgroundColor:"#0ea5e933",pointBackgroundColor:"#0ea5e9",pointBorderColor:"#ffffff",pointRadius:3,pointHoverRadius:6,tension:.35,fill:!0}]},this.dayOpts={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}},elements:{point:{radius:3,hoverRadius:6}},scales:{y:{beginAtZero:!0}}},this.isLoading=!1,this.timedOut=!1,this.error="",this.baseDayLabels&&this.baseDayLabels.length>0){let i=this.baseDayLabels[this.baseDayLabels.length-1],t=new Date(i+"T12:00:00");if(!isNaN(t.getTime())){let n=new Date(t);n.setDate(n.getDate()-40);let h=c=>`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`;this.chartEndDate=h(t),this.chartStartDate=h(n),this.updateDayChartForRange(n,t)}}}applyFilters(){let l=(this.searchTerm||"").toLowerCase(),e=this.selectedOperation||"",i=!!this.startDate,t=!!this.endDate,n=i?new Date(this.startDate+"T00:00:00"):null,h=t?new Date(this.endDate+"T23:59:59"):null;this.filteredVideos=this.videos.filter(c=>{let w=!l||c.titulo?.toLowerCase().includes(l)||c.descricao?.toLowerCase().includes(l),E=!e||c.operation_id?.toString()===e||c.operation?.toString()===e,R=!0;if(i||t){let k=c.data_postagem||c.date||c.day,V=k?new Date(k):null;V&&!isNaN(V.getTime())?(n&&V<n&&(R=!1),h&&V>h&&(R=!1)):R=!1}return w&&E&&R})}applyChartRange(){let l=!!this.chartStartDate,e=!!this.chartEndDate,i=l?new Date(this.chartStartDate+"T00:00:00"):null,t=e?new Date(this.chartEndDate+"T23:59:59"):null;this.updateDayChartForRange(i,t)}updateDayChartForRange(l,e){if(!this.baseDayLabels||!this.baseDayLabels.length)return;let i=!!l,t=!!e;if(!i&&!t){this.dayChart={labels:this.baseDayLabels,datasets:[L(M({},this.dayChart.datasets[0]),{data:this.baseDayValues})]};return}let n=[],h=[];for(let c=0;c<this.baseDayLabels.length;c++){let w=this.baseDayLabels[c],E=new Date(w+"T12:00:00");isNaN(E.getTime())||i&&E<l||t&&E>e||(n.push(w),h.push(this.baseDayValues[c]))}this.dayChart={labels:n,datasets:[L(M({},this.dayChart.datasets[0]),{data:h})]}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=A({type:r,selectors:[["app-eventos-real"]],decls:11,vars:5,consts:[["noYear",""],["noDay",""],["noVideos",""],[1,"space-y-6"],[1,"bg-white","rounded-xl","border","border-slate-200","p-6"],[1,"text-2xl","font-bold","text-slate-900"],["class","text-slate-600 text-base ml-2",4,"ngIf"],[1,"text-slate-600","mt-1"],["class","bg-white rounded-xl border border-slate-200 p-6",4,"ngIf"],["class","bg-white rounded-xl border border-slate-200 p-6 text-red-600",4,"ngIf"],["class","bg-amber-50 border border-amber-200 text-amber-700 rounded-md p-3",4,"ngIf"],[4,"ngIf"],[1,"text-slate-600","text-base","ml-2"],[1,"bg-white","rounded-xl","border","border-slate-200","p-6","text-red-600"],[1,"bg-amber-50","border","border-amber-200","text-amber-700","rounded-md","p-3"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"bg-white","border","border-slate-200","rounded-xl","p-4"],[1,"text-slate-500","text-sm"],[1,"text-2xl","font-bold"],[1,"text-slate-800","font-medium","text-sm","break-all"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"font-semibold","text-slate-900","mb-3"],[4,"ngIf","ngIfElse"],[1,"bg-white","rounded-xl","border","border-slate-200","p-6","h-96"],[1,"flex","items-center","justify-between","mb-3","gap-2"],[1,"font-semibold","text-slate-900"],[1,"flex","items-center","gap-2"],["type","date","inputmode","numeric","pattern","\\\\d{4}-\\\\d{2}-\\\\d{2}","placeholder","YYYY-MM-DD",1,"px-2","py-1","border","border-slate-300","rounded",3,"ngModelChange","change","ngModel"],["type","line","height","90%",3,"data","options"],[1,"text-slate-500"],[1,"grid","grid-cols-1","lg:grid-cols-4","gap-4","mb-6"],[1,"lg:col-span-2"],[1,"block","text-sm","font-medium","text-slate-700","mb-2"],["type","text","placeholder","Digite sua busca...",1,"block","w-full","px-3","py-2","border","border-slate-300","rounded-lg",3,"ngModelChange","input","ngModel"],["type","date","inputmode","numeric","pattern","\\\\d{4}-\\\\d{2}-\\\\d{2}","placeholder","YYYY-MM-DD",1,"block","w-full","px-3","py-2","border","border-slate-300","rounded-lg",3,"ngModelChange","input","ngModel"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["class","border border-slate-200 rounded-lg p-4",4,"ngFor","ngForOf"],[1,"border","border-slate-200","rounded-lg","p-4"],[1,"text-sm","text-slate-500","mb-1"],[1,"font-medium","text-slate-800"],[1,"text-slate-500","text-sm","truncate",3,"title"],[1,"mt-2","text-sm"],[1,"px-2","py-0.5","rounded","bg-slate-100","text-slate-700"],[1,"mt-3"],["class","text-blue-600 hover:underline","target","_blank","rel","noopener",3,"href",4,"ngIf"],["target","_blank","rel","noopener",1,"text-blue-600","hover:underline",3,"href"]],template:function(e,i){e&1&&(o(0,"div",3)(1,"header",4)(2,"h1",5),d(3," Eventos \u2014 Cen\xE1rio real "),f(4,se,2,1,"span",6),a(),o(5,"p",7),d(6,"Dados de eventos detectados pela heur\xEDstica no dataset selecionado."),a()(),f(7,de,2,0,"div",8)(8,pe,2,1,"div",9)(9,ce,2,0,"div",10)(10,ve,48,16,"ng-container",11),a()),e&2&&(s(4),m("ngIf",i.meta==null?null:i.meta.label),s(3),m("ngIf",i.isLoading),s(),m("ngIf",!i.isLoading&&i.error),s(),m("ngIf",i.timedOut&&!i.error),s(),m("ngIf",!i.isLoading&&!i.error))},dependencies:[K,Z,q,ae,ee,te,ie,ne,$,X,J,G,z],encapsulation:2})};export{le as EventosRealComponent};
