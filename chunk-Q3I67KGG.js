import{L as D}from"./chunk-OSVV57MB.js";import{a as f,b as h,f as b}from"./chunk-EQDQRRRY.js";var v=class g{base;constructor(){let e=document.getElementsByTagName("base")[0],t=e&&e.getAttribute("href")||"/",s=t.endsWith("/")?t:t+"/";this.base=`${s}assets/data/events/cenario-real`}fetchJson(e){return b(this,null,function*(){try{let t=yield fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}`);return t.json()}catch(t){throw console.error("[EventsRealService] fetchJson error:",e,t),t}})}getDatasets(){return b(this,null,function*(){let e=`${this.base}/datasets.json`;return(yield this.fetchJson(e))??{}})}loadDataset(e){return b(this,null,function*(){let s=(yield this.getDatasets())[e];if(!s)throw new Error(`Dataset "${e}" n\xE3o encontrado em datasets.json`);let n=this.resolveAssetUrl(s.file),a=yield this.fetchJson(n),r=this.normalizeVideos(a),{byYear:l,byDay:u,period:c,opCount:p}=this.aggregate(r);return{meta:{id:e,label:s.label,description:s.description,period:c,totalVideos:r.length,totalOperations:p},videos:r,series:{byYear:l,byDay:u}}})}resolveAssetUrl(e){return e.startsWith("events/")?`${this.base.replace("/cenario-real","")}/${e.replace(/^events\//,"")}`:`${this.base}/${e}`}normalizeVideos(e){return Array.isArray(e)?e.map(t=>{let s=t.data_postagem||t.date||t.day||null,n=null;if(s){let r=new Date(s);n=isNaN(r.getTime())?null:r}let a=(t.operation_ner??t.operation??t.op??"").toString().trim();return h(f({},t),{parsedDate:n,operation_id:a})}).filter(t=>!!t.parsedDate):[]}aggregate(e){let t={},s={},n=new Set,a=null,r=null;for(let o of e){let i=o.parsedDate,d=String(i.getUTCFullYear()),y=i.toISOString().slice(0,10);t[d]=(t[d]||0)+1,s[y]=(s[y]||0)+1;let m=(o.operation_id||"").toString().trim();m&&n.add(m),(!a||i<a)&&(a=i),(!r||i>r)&&(r=i)}let l=Object.keys(t).sort(),u=l.map(o=>t[o]),c=Object.keys(s).sort(),p=c.map(o=>s[o]),S=a&&r?`${a.toISOString().slice(0,10)} \u2013 ${r.toISOString().slice(0,10)}`:"\u2014";return{byYear:{labels:l,values:u},byDay:{labels:c,values:p},period:S,opCount:n.size}}static \u0275fac=function(t){return new(t||g)};static \u0275prov=D({token:g,factory:g.\u0275fac,providedIn:"root"})};export{v as a};
