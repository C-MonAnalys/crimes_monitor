import{a as ae}from"./chunk-BKUN2DL6.js";import{a as Q}from"./chunk-UZA4GBYO.js";import{b as X,c as Y,d as ee,e as te,f as ie,h as ne}from"./chunk-3T4JATVU.js";import{j as F,l as G,m as K}from"./chunk-Z2TUEXGM.js";import{a as oe}from"./chunk-Q6ESINKT.js";import{k as U,m as J,o as Z}from"./chunk-TL75RN7M.js";import{Fa as q,Hb as D,Ib as w,Ka as S,Lb as k,Na as V,Q as N,Ub as H,V as W,W as $,Xa as b,Ya as t,Za as n,_a as c,ca as _,cb as I,db as M,eb as j,hb as z,ib as E,nb as L,sb as a,tb as y,ua as d,ub as P}from"./chunk-OSVV57MB.js";import{f as O}from"./chunk-EQDQRRRY.js";function se(o,i){o&1&&(t(0,"div",5),a(1," Carregando\u2026 "),n())}function le(o,i){if(o&1&&(t(0,"div",11),a(1),n()),o&2){let e=E();d(),P(" ",e.error," ")}}function de(o,i){if(o&1&&(I(0),t(1,"div",47)(2,"span",48),c(3,"i",49),a(4," Desaprova\xE7\xE3o: "),t(5,"span",50),a(6),D(7,"number"),n()(),t(8,"span",51),c(9,"i",52),a(10," Neutro: "),t(11,"span",50),a(12),D(13,"number"),n()(),t(14,"span",53),c(15,"i",54),a(16," Aprova\xE7\xE3o: "),t(17,"span",50),a(18),D(19,"number"),n()()(),M()),o&2){let e=E(2);d(6),y(w(7,3,e.dataset().labels.neg)),d(6),y(w(13,5,e.dataset().labels.neu)),d(6),y(w(19,7,e.dataset().labels.pos))}}function me(o,i){o&1&&(t(0,"div",55),a(1,"Dados de treino n\xE3o encontrados neste ambiente."),n())}function ce(o,i){if(o&1&&(t(0,"div",56)(1,"div",57)(2,"span",21),c(3,"i",58),n(),t(4,"div")(5,"div",50),a(6,"Aten\xE7\xE3o ao desequil\xEDbrio de classes"),n(),t(7,"div",59),a(8),n()()()()),o&2){let e=E(2);d(8),y(e.imbalanceWarn())}}function pe(o,i){if(o&1&&(I(0),c(1,"p-chart",60),M()),o&2){let e=E(2);d(),b("data",e.distData)("options",e.distOpts)}}function ue(o,i){o&1&&(t(0,"div",61),a(1,"Sem dados de r\xF3tulos para o gr\xE1fico."),n())}function ge(o,i){if(o&1&&(I(0),t(1,"div",62),c(2,"p-chart",63),n(),M()),o&2){let e=E(2);d(2),b("data",e.compChartData)("options",e.compChartOpts)}}function xe(o,i){o&1&&(t(0,"div",61),a(1," Sem arquivos de compara\xE7\xE3o de modelos encontrados. Adicione JSON/CSV em "),t(2,"code"),a(3,"assets/data/sentiment/bootstrap/"),n(),a(4," e um "),t(5,"code"),a(6,"index.json"),n(),a(7," manifest. "),n())}function be(o,i){if(o&1&&(I(0),c(1,"app-bootstrap-results-card",64),M()),o&2){let e=E(2);d(),b("groups",e.groupedBootstrap())}}function fe(o,i){o&1&&(t(0,"div",65),a(1," Sem resultados de bootstrap dispon\xEDveis. "),n())}function he(o,i){if(o&1){let e=j();I(0),t(1,"section",12)(2,"div",13)(3,"div",14)(4,"span",15),c(5,"i",16),n(),t(6,"span"),a(7,"Total de Coment\xE1rios"),n()(),t(8,"div",17),a(9),D(10,"number"),n(),c(11,"div",18),t(12,"div",19),a(13,"Per\xEDodo: "),t(14,"span",20),a(15),n()()(),t(16,"div",13)(17,"div",14)(18,"span",21),c(19,"i",22),n(),t(20,"span"),a(21,"Distribui\xE7\xE3o de R\xF3tulos"),n()(),S(22,de,20,9,"ng-container",23)(23,me,2,0,"ng-template",null,0,k),n(),t(25,"div",13)(26,"div",14)(27,"span",24),c(28,"i",25),n(),t(29,"span"),a(30,"Precis\xE3o do Modelo (Resumo)"),n()(),t(31,"div",26)(32,"div",27)(33,"div",28),a(34,"Precis\xE3o"),n(),t(35,"div",29),a(36),n()(),t(37,"div",27)(38,"div",28),a(39,"Recall"),n(),t(40,"div",29),a(41),n()(),t(42,"div",27)(43,"div",28),a(44,"F1-Score"),n(),t(45,"div",29),a(46),n()()()()(),S(47,ce,9,1,"div",30),t(48,"section",12)(49,"div",13)(50,"div",14)(51,"span",15),c(52,"i",31),n(),t(53,"span"),a(54,"Comprimento m\xE9dio"),n()(),t(55,"div",17),a(56),D(57,"number"),n(),t(58,"div",32),a(59,"caracteres por coment\xE1rio"),n()(),t(60,"div",13)(61,"div",14)(62,"span",15),c(63,"i",33),n(),t(64,"span"),a(65,"Mediana"),n()(),t(66,"div",17),a(67),D(68,"number"),n(),t(69,"div",32),a(70,"caracteres"),n()(),t(71,"div",13)(72,"div",14)(73,"span",15),c(74,"i",34),n(),t(75,"span"),a(76,"% curtos (<30)"),n()(),t(77,"div",17),a(78),n(),t(79,"div",32),a(80,"dos coment\xE1rios"),n()()(),t(81,"section",35)(82,"div",36)(83,"div",14)(84,"span",21),c(85,"i",37),n(),t(86,"span"),a(87,"Distribui\xE7\xE3o de R\xF3tulos (Treino)"),n()(),c(88,"div",18),S(89,pe,2,2,"ng-container",23)(90,ue,2,0,"ng-template",null,1,k),n()(),t(92,"section",38)(93,"div",39)(94,"div",40),a(95,"Compara\xE7\xE3o de modelos por m\xE9trica (IC 95%)"),n(),t(96,"label",41),a(97," M\xE9trica: "),t(98,"select",42),z("ngModelChange",function(l){W(e);let m=E();return m.selectedMetric.set(l),$(m.onMetricChange())}),t(99,"option",43),a(100,"Precis\xE3o"),n(),t(101,"option",44),a(102,"Revoca\xE7\xE3o"),n(),t(103,"option",45),a(104,"F1-Score"),n()()()(),t(105,"div",46),S(106,ge,3,2,"ng-container",23)(107,xe,8,0,"ng-template",null,2,k),n()(),S(109,be,2,1,"ng-container",23)(110,fe,2,0,"ng-template",null,3,k),M()}if(o&2){let e=L(24),s=L(91),l=L(108),m=L(111),r=E();d(9),y(w(10,18,r.dataset().total)),d(6),y(r.dataset().period),d(7),b("ngIf",r.hasLabelData)("ngIfElse",e),d(14),P("",r.modelAccuracy().precision,"%"),d(5),P("",r.modelAccuracy().recall,"%"),d(5),P("",r.modelAccuracy().f1Score,"%"),d(),b("ngIf",r.imbalanceWarn()),d(9),y(w(57,20,r.quality().avgLen)),d(11),y(w(68,22,r.quality().medianLen)),d(11),P("",r.quality().pShort,"%"),d(11),b("ngIf",r.hasLabelData)("ngIfElse",s),d(9),b("ngModel",r.selectedMetric()),d(8),b("ngIf",r.modelsComp().length>0&&r.compChartData)("ngIfElse",l),d(3),b("ngIf",r.hasBootstrapData)("ngIfElse",m)}}var ve={id:"errorBars",afterDatasetsDraw(o){let i=o.scales.y;if(!i)return;let e=o.ctx;o.data.datasets.forEach((s,l)=>{if(!s?.errorBars||!Array.isArray(s.errorBars))return;let m=o.getDatasetMeta(l);s.errorBars.forEach((r,f)=>{let h=m.data?.[f];if(!h)return;let v=h.x,C=i.getPixelForValue(r.upper),p=i.getPixelForValue(r.lower);e.save(),e.strokeStyle=s.borderColor??"rgba(0,0,0,0.6)",e.globalAlpha=.9,e.lineWidth=2,e.beginPath(),e.moveTo(v,C),e.lineTo(v,p),e.stroke();let u=6;e.beginPath(),e.moveTo(v-u,C),e.lineTo(v+u,C),e.moveTo(v-u,p),e.lineTo(v+u,p),e.stroke(),e.restore()})})}};F.register(ve);var Ee={id:"errorWhiskers",afterDatasetsDraw(o){let{ctx:i,scales:e}=o,s=e.y;o.data.datasets.forEach((l,m)=>{if(l.type!=="line"||l.showLine!==!1||!Array.isArray(l.errorBars))return;let r=o.getDatasetMeta(m),f=l.pointBackgroundColor||l.borderColor||"#334155",h=6,v=2;i.save(),i.strokeStyle=f,i.lineWidth=v,r.data.forEach((C,p)=>{let u=l.errorBars[p];if(!u)return;let g=C.x,T=s.getPixelForValue(u.low),A=s.getPixelForValue(u.high);i.beginPath(),i.moveTo(g,T),i.lineTo(g,A),i.stroke(),i.beginPath(),i.moveTo(g-h/2,T),i.lineTo(g+h/2,T),i.moveTo(g-h/2,A),i.lineTo(g+h/2,A),i.stroke()}),i.restore()})}};F.register(Ee);var re=class o{sentiments=N(Q);cdr=N(H);zone=N(V);isLoading=!0;error="";timedOut=!1;dataset=_({total:0,labels:{neg:0,neu:0,pos:0},period:"\u2014"});bootstrap=_([]);modelAccuracy=_({precision:0,recall:0,f1Score:0});hasLabelData=!1;hasBootstrapData=!1;distData;distOpts;quality=_({avgLen:0,medianLen:0,pShort:0});imbalanceWarn=_(null);selectedMetric=_("precision");modelsComp=_([]);compChartData;compChartOpts;ngOnInit(){return O(this,null,function*(){let i=this.sentiments.getTrainingStats();try{let e=yield oe(i,5e3);this.applyData(e);try{let s=yield this.sentiments.getBootstrapComparisons();this.modelsComp.set(s),this.buildComparisonChart()}catch(s){console.warn("[avaliacoes-posicionamento] compara\xE7\xE3o de modelos indispon\xEDvel:",s)}this.isLoading=!1}catch(e){e?.message==="TIMEOUT"?(this.timedOut=!0,this.isLoading=!1,this.error="",i.then(s=>{this.zone.run(()=>{this.applyData(s),this.timedOut=!1,this.cdr.markForCheck()})}).catch(s=>{this.zone.run(()=>{this.error="N\xE3o foi poss\xEDvel carregar estat\xEDsticas de treino.",this.cdr.markForCheck()})})):(this.error="N\xE3o foi poss\xEDvel carregar estat\xEDsticas de treino.",this.isLoading=!1)}})}applyData(i){if(!i)return;this.dataset.set({total:i.total??0,labels:{neg:i.labels?.["-1"]??0,neu:i.labels?.["0"]??0,pos:i.labels?.["1"]??0},period:i.period??"\u2014"}),this.quality.set(i.quality||{avgLen:0,medianLen:0,pShort:0});let{neg:e,neu:s,pos:l}=this.dataset().labels,m=this.dataset().total||0,r=m?{neg:Math.round(e/m*100),neu:Math.round(s/m*100),pos:Math.round(l/m*100)}:{neg:0,neu:0,pos:0};this.imbalanceWarn.set(r.neg<10||r.neu<10||r.pos<10?`Aten\xE7\xE3o: poss\xEDvel desequil\xEDbrio de classes (Desaprova\xE7\xE3o: ${r.neg}%, Neutro: ${r.neu}%, Aprova\xE7\xE3o: ${r.pos}%).`:null),this.bootstrap.set(Array.isArray(i.bootstrap)?i.bootstrap:[]),this.modelAccuracy.set(this.calcAccuracy(this.bootstrap())),this.hasLabelData=e+s+l>0,this.hasBootstrapData=this.bootstrap().length>0,this.distData={labels:["Desaprova\xE7\xE3o","Neutro","Aprova\xE7\xE3o"],datasets:[{data:[e,s,l],backgroundColor:["#ef4444","#6b7280","#10b981"],borderWidth:0}]},this.distOpts={responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:8,right:8,bottom:16,left:8}},plugins:{legend:{display:!0,position:"bottom",align:"center",labels:{usePointStyle:!0,pointStyle:"circle",boxWidth:10,boxHeight:10,padding:12,font:{size:11},color:"#334155"}},tooltip:{callbacks:{label:f=>`${f.label}: ${f.parsed} coment\xE1rios`}}},animation:{duration:0}}}calcAccuracy(i){let e=s=>{let l=i?.filter(r=>r[""]?.startsWith(s))??[];if(!l.length)return 0;let m=l.reduce((r,f)=>r+(f.mean||0),0)/l.length;return Math.round(m*100)};return{precision:e("precision_class_"),recall:e("recall_class_"),f1Score:e("f1_class_")}}groupBootstrap(i){if(!Array.isArray(i)||!i.length)return[];let e={};for(let s of i){let l=s?.[""];if(!l)continue;let[m,r]=l.split("class");e[m]||(e[m]={metric:m,items:[]}),e[m].items.push({class:r,mean:s.mean,lower_ci:s.lower_95_ci,upper_ci:s.upper_95_ci})}return Object.values(e)}groupedBootstrap(){return this.groupBootstrap(this.bootstrap())}onMetricChange(){this.buildComparisonChart(),this.cdr.markForCheck()}buildComparisonChart(){let i=this.modelsComp();if(!i||!i.length){this.compChartData=null;return}let e=this.selectedMetric(),s=["Neutro","Aprova","Desaprova"],l=["#2563eb","#10b981","#f59e0b","#8b5cf6","#ef4444","#14b8a6"],m=[],r=1,f=0;i.forEach((p,u)=>{let g=p.metrics[e]||[],T=[0,1,2].map(x=>g.find(B=>B.class===x)?.mean??0),A=[0,1,2].map(x=>g.find(B=>B.class===x)?.lower??0),R=[0,1,2].map(x=>g.find(B=>B.class===x)?.upper??0);A.forEach(x=>{x<r&&(r=x)}),R.forEach(x=>{x>f&&(f=x)}),m.push({type:"line",label:`${p.model}`,data:T,showLine:!1,pointBackgroundColor:l[u%l.length],pointBorderColor:l[u%l.length],pointRadius:6,pointHoverRadius:8,hitRadius:12,borderWidth:0,order:1,errorBars:[0,1,2].map(x=>({low:A[x],high:R[x]}))})});let h=.03,v=Math.max(0,r-h),C=Math.min(1,f+h);this.compChartData={labels:s,datasets:m},this.compChartOpts={responsive:!0,maintainAspectRatio:!1,layout:{padding:{left:8,right:8}},plugins:{legend:{position:"bottom",labels:{usePointStyle:!0,boxWidth:10,boxHeight:10,font:{size:11}}},tooltip:{callbacks:{label:p=>{if(Array.isArray(p.raw))return"";let u=p.dataset,g=u.errorBars?.[p.dataIndex];return g?`${u.label}: m\xE9dia ${(p.parsed.y*100).toFixed(1)}% \u2014 IC95% [${(g.low*100).toFixed(1)}%; ${(g.high*100).toFixed(1)}%]`:`${u.label}: m\xE9dia ${(p.parsed.y*100).toFixed(1)}%`}}}},scales:{x:{offset:!0,ticks:{padding:8}},y:{suggestedMin:v,suggestedMax:C,ticks:{callback:p=>Number(p)*100+"%"},title:{display:!0,text:e==="precision"?"Precis\xE3o":e==="recall"?"Revoca\xE7\xE3o":"F1-Score"}}}},this.cdr.markForCheck()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=q({type:o,selectors:[["app-avaliacoes-posicionamento"]],decls:9,vars:3,consts:[["noLabels",""],["noLabelsChart",""],["noComp",""],["noBootstrap",""],[1,"space-y-6"],[1,"bg-white","rounded-xl","border","border-slate-200","p-5"],[1,"text-xl","md:text-2xl","font-bold","text-slate-900"],[1,"text-slate-600","mt-1"],["class","bg-white rounded-xl border border-slate-200 p-5",4,"ngIf"],["class","bg-white rounded-xl border border-slate-200 p-5 text-red-600",4,"ngIf"],[4,"ngIf"],[1,"bg-white","rounded-xl","border","border-slate-200","p-5","text-red-600"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"bg-white","rounded-xl","border","border-slate-200","shadow-sm","hover:shadow-md","transition","p-4"],[1,"flex","items-center","gap-2","text-slate-500","text-[11px]","font-medium","uppercase","tracking-wide"],[1,"flex","items-center","justify-center","w-5","h-5","rounded-full","bg-blue-100","text-blue-700"],[1,"bi","bi-chat-text","text-[12px]"],[1,"mt-1.5","text-2xl","font-extrabold","text-slate-900"],[1,"h-px","bg-slate-200/70","my-2"],[1,"text-[11px]","text-slate-500"],[1,"font-medium"],[1,"flex","items-center","justify-center","w-5","h-5","rounded-full","bg-amber-100","text-amber-700"],[1,"bi","bi-diagram-3","text-[12px]"],[4,"ngIf","ngIfElse"],[1,"flex","items-center","justify-center","w-5","h-5","rounded-full","bg-emerald-100","text-emerald-700"],[1,"bi","bi-graph-up-arrow","text-[12px]"],[1,"mt-2","grid","grid-cols-3","gap-2","text-center"],[1,"rounded-lg","border","border-slate-200","bg-slate-50","p-2"],[1,"text-[10px]","text-slate-500"],[1,"text-lg","font-semibold","text-slate-900"],["class","rounded-xl border border-amber-200 bg-amber-50/70 text-amber-800 p-4 shadow-sm",4,"ngIf"],[1,"bi","bi-rulers","text-[12px]"],[1,"text-[11px]","text-slate-500","mt-0.5"],[1,"bi","bi-graph-up","text-[12px]"],[1,"bi","bi-lightning-charge","text-[12px]"],[1,"grid","grid-cols-1","gap-6"],[1,"bg-white","rounded-xl","border","border-slate-200","shadow-sm","p-5","h-96"],[1,"bi","bi-pie-chart","text-[12px]"],[1,"space-y-3"],[1,"flex","items-center","justify-between","bg-white","rounded-xl","border","border-slate-200","p-4"],[1,"font-semibold","text-slate-900"],[1,"text-sm","text-slate-700","flex","items-center","gap-2"],[1,"border","border-slate-300","rounded-md","px-2","py-1","text-sm",3,"ngModelChange","ngModel"],["value","precision"],["value","recall"],["value","f1"],[1,"bg-white","rounded-xl","border","border-slate-200","p-5","h-[460px]","overflow-hidden"],[1,"mt-2","flex","flex-wrap","gap-2","text-[13px]"],[1,"inline-flex","items-center","gap-1","px-2","py-0.5","rounded-full","text-[12px]","font-medium","bg-rose-50","text-rose-700","border","border-rose-200"],[1,"bi","bi-dash-circle"],[1,"font-semibold"],[1,"inline-flex","items-center","gap-1","px-2","py-0.5","rounded-full","text-[12px]","font-medium","bg-slate-50","text-slate-700","border","border-slate-200"],[1,"bi","bi-circle"],[1,"inline-flex","items-center","gap-1","px-2","py-0.5","rounded-full","text-[12px]","font-medium","bg-emerald-50","text-emerald-700","border","border-emerald-200"],[1,"bi","bi-check-circle"],[1,"mt-2","text-slate-500"],[1,"rounded-xl","border","border-amber-200","bg-amber-50/70","text-amber-800","p-4","shadow-sm"],[1,"flex","items-start","gap-2"],[1,"bi","bi-exclamation-triangle-fill","text-[12px]"],[1,"text-sm","mt-0.5"],["type","doughnut","height","100%",3,"data","options"],[1,"text-slate-500"],[1,"h-[400px]"],["type","line","height","100%",3,"data","options"],[3,"groups"],[1,"bg-white","rounded-xl","border","border-slate-200","p-5","text-slate-500"]],template:function(e,s){e&1&&(t(0,"div",4)(1,"header",5)(2,"h1",6),a(3,"Avalia\xE7\xE3o de Desempenho \u2014 Posicionamento"),n(),t(4,"p",7),a(5,"Estat\xEDsticas do dataset de treino e m\xE9tricas do modelo BERT."),n()(),S(6,se,2,0,"div",8)(7,le,2,1,"div",9)(8,he,112,24,"ng-container",10),n()),e&2&&(d(6),b("ngIf",s.isLoading),d(),b("ngIf",!s.isLoading&&s.error),d(),b("ngIf",!s.isLoading&&!s.error))},dependencies:[Z,U,K,G,ae,ne,te,ie,ee,X,Y,J],encapsulation:2})};export{re as AvaliacoesPosicionamentoComponent};
