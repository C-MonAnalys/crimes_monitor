import{a as k,b as T,c as O,d as B,e as N}from"./chunk-LAWH2TAW.js";import"./chunk-WCJ3VB4Q.js";import{m as D}from"./chunk-MWBKWIFM.js";import{a as j}from"./chunk-D2DEWXXK.js";import{d as A}from"./chunk-IAGVYY6L.js";import{a as L}from"./chunk-Q6ESINKT.js";import{k as P,m as M,o as w}from"./chunk-GOJ2ZNOE.js";import{Aa as a,Ab as S,La as b,Nb as E,Ob as I,Qa as f,Ta as v,W as h,_b as R,bb as r,cb as s,db as m,eb as d,f as C,ib as y,jb as _,ob as g,yb as p,zb as x}from"./chunk-QQS62GLD.js";function W(o,e){o&1&&(s(0,"div",1),p(1,"Carregando\u2026"),m())}function G(o,e){if(o&1&&(s(0,"div",9),p(1),m()),o&2){let t=g();a(),x(t.error)}}function q(o,e){o&1&&(s(0,"div",10),p(1," Conex\xE3o lenta. Exibindo o que j\xE1 foi carregado\u2026 "),m())}function U(o,e){if(o&1&&d(0,"app-weekly-stacked-chart",20),o&2){let t=g(2);r("comments",t.comments)("bootstrapData",t.bootstrapStats)}}function V(o,e){o&1&&(s(0,"div",21),p(1," Sem coment\xE1rios para exibir. "),m())}function Z(o,e){if(o&1&&(y(0),s(1,"div",11),d(2,"app-analysis-stat-card",12),E(3,"number"),d(4,"app-analysis-stat-card",12)(5,"app-analysis-stat-card",12)(6,"app-analysis-stat-card",12),m(),s(7,"div",13),d(8,"app-positioning-distribution",14)(9,"app-topics-card",15),m(),s(10,"div",16),f(11,U,1,2,"app-weekly-stacked-chart",17)(12,V,2,0,"div",18),m(),s(13,"div",13),d(14,"app-positioning-doughnut-chart",19),m(),_()),o&2){let t=g();a(2),r("label","Opini\xF5es Analisadas")("value",I(3,23,t.totalComments)??"0")("icon","bi-chat-text")("color","blue"),a(2),r("label","Aprova\xE7\xE3o")("value",t.sentimentPercentages.positive+"%")("icon","bi-emoji-smile")("color","green"),a(),r("label","Desaprova\xE7\xE3o")("value",t.sentimentPercentages.negative+"%")("icon","bi-emoji-frown")("color","red"),a(),r("label","Neutro")("value",t.sentimentPercentages.neutral+"%")("icon","bi-emoji-neutral")("color","yellow"),a(2),r("counts",t.sentimentCounts)("percentages",t.sentimentPercentages),a(),r("topicCounts",t.topicCounts),a(2),r("ngIf",t.comments.length),a(),r("ngIf",!t.comments.length),a(2),r("data",t.sentimentChartData)("options",t.sentimentChartOptions)}}var z=class o{route=h(A);sentiments=h(j);cdr=h(R);zone=h(v);isLoading=!0;timedOut=!1;error="";datasetId="";comments=[];bootstrapStats=[];bootstrapGroups=[];totalComments=0;sentimentCounts={"-1":0,0:0,1:0};sentimentPercentages={negative:0,neutral:0,positive:0};topicCounts={security:0,violence:0,police:0,management:0};sampleComments=[];metrics=[];modelAccuracy={precision:0,recall:0,f1Score:0};sentimentChartData={};sentimentChartOptions={};metricsChartData={};metricsChartOptions={};ngOnInit(){return C(this,null,function*(){this.datasetId=this.route.snapshot.paramMap.get("id")||"";let e=this.sentiments.loadDataset(this.datasetId);try{let t=yield L(e,5e3);this.zone.run(()=>this.applyAll(t))}catch(t){t?.message==="TIMEOUT"?(this.zone.run(()=>{this.timedOut=!0,this.isLoading=!1,this.error="",this.cdr.markForCheck()}),e.then(n=>this.zone.run(()=>this.applyAll(n))).catch(()=>this.zone.run(()=>{this.error="N\xE3o foi poss\xEDvel carregar o dataset.",this.cdr.markForCheck()}))):this.zone.run(()=>{this.error="N\xE3o foi poss\xEDvel carregar o dataset.",this.isLoading=!1,this.cdr.markForCheck()})}})}applyAll(e){if(this.comments=Array.isArray(e?.comments)?e.comments:[],this.totalComments=this.comments.length,this.sentimentCounts=this.computeSentimentCounts(this.comments),this.totalComments>0){this.sentimentPercentages={negative:Math.round(this.sentimentCounts[-1]/this.totalComments*100),neutral:Math.round(this.sentimentCounts[0]/this.totalComments*100),positive:Math.round(this.sentimentCounts[1]/this.totalComments*100)},this.topicCounts={security:Math.floor(this.totalComments*.65),violence:Math.floor(this.totalComments*.45),police:Math.floor(this.totalComments*.38),management:Math.floor(this.totalComments*.22)};let i=this.comments.filter(l=>l.comentario&&l.comentario.length>50),c=i.filter(l=>l.new_BERT===1).slice(0,2),u=i.filter(l=>l.new_BERT===0).slice(0,2),F=i.filter(l=>l.new_BERT===-1).slice(0,2);this.sampleComments=[...c,...u,...F]}this.bootstrapStats=Array.isArray(e?.bootstrap)?e.bootstrap:[],this.bootstrapGroups=this.groupBootstrapResults(this.bootstrapStats),this.bootstrapStats.length&&(this.metrics=this.bootstrapStats,this.calculateModelAccuracy(this.bootstrapStats)),this.sentimentChartData={labels:["Desaprova\xE7\xE3o","Neutro","Aprova\xE7\xE3o"],datasets:[{data:[this.sentimentPercentages.negative,this.sentimentPercentages.neutral,this.sentimentPercentages.positive],backgroundColor:["#ef4444","#6b7280","#10b981"],borderWidth:0}]},this.sentimentChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}};let t=this.metrics.map(i=>i[""]||"M\xE9trica"),n=this.metrics.map(i=>i.mean||0);this.metricsChartData={labels:t,datasets:[{label:"M\xE9dia (Mean)",data:n,backgroundColor:"rgba(59,130,246,0.7)",borderColor:"rgb(59,130,246)",borderWidth:1}]},this.metricsChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}}},this.isLoading=!1,this.timedOut=!1,this.error="",this.cdr.markForCheck()}groupBootstrapResults(e){if(!e?.length)return[];let t={};for(let n of e){let i=n[""];if(!i)continue;let[c,u]=i.split("class");t[c]||(t[c]={metric:c,items:[]}),t[c].items.push({class:u,mean:n.mean,lower_ci:n.lower_95_ci,upper_ci:n.upper_95_ci})}return Object.values(t)}calculateModelAccuracy(e){let t=n=>{let i=e.filter(c=>c[""]?.startsWith(n));return i.length?Math.round(i.reduce((c,u)=>c+(u.mean||0),0)/i.length*100):0};this.modelAccuracy={precision:t("precision_class_"),recall:t("recall_class_"),f1Score:t("f1_class_")}}computeSentimentCounts(e){let t={"-1":0,0:0,1:0};for(let n of e||[]){let i=String(n?.new_BERT??"0");i in t&&t[i]++}return t}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=b({type:o,selectors:[["app-posicionamento-real"]],decls:12,vars:5,consts:[[1,"space-y-6"],[1,"bg-white","rounded-xl","border","border-slate-200","p-6"],[1,"text-2xl","font-bold","text-slate-900"],[1,"text-slate-600","text-base","ml-2"],[1,"text-slate-600","mt-1"],["class","bg-white rounded-xl border border-slate-200 p-6",4,"ngIf"],["class","bg-white rounded-xl border border-slate-200 p-6 text-red-600",4,"ngIf"],["class","bg-amber-50 border border-amber-200 text-amber-700 rounded-md p-3",4,"ngIf"],[4,"ngIf"],[1,"bg-white","rounded-xl","border","border-slate-200","p-6","text-red-600"],[1,"bg-amber-50","border","border-amber-200","text-amber-700","rounded-md","p-3"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6"],[3,"label","value","icon","color"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","mt-6"],[3,"counts","percentages"],[3,"topicCounts"],[1,"mt-6"],[3,"comments","bootstrapData",4,"ngIf"],["class","bg-white rounded-xl border border-slate-200 p-6 text-slate-500",4,"ngIf"],[3,"data","options"],[3,"comments","bootstrapData"],[1,"bg-white","rounded-xl","border","border-slate-200","p-6","text-slate-500"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"header",1)(2,"h1",2),p(3," Posicionamento \u2014 Cen\xE1rio real "),s(4,"span",3),p(5),m()(),s(6,"p",4),p(7,"Infer\xEAncia do modelo sobre coment\xE1rios reais do dataset selecionado."),m()(),f(8,W,2,0,"div",5)(9,G,2,1,"div",6)(10,q,2,0,"div",7)(11,Z,15,25,"ng-container",8),m()),t&2&&(a(5),S("(",n.datasetId,")"),a(3),r("ngIf",n.isLoading),a(),r("ngIf",!n.isLoading&&n.error),a(),r("ngIf",n.timedOut&&!n.error),a(),r("ngIf",!n.isLoading&&!n.error))},dependencies:[w,P,D,k,T,O,B,N,M],encapsulation:2})};export{z as PosicionamentoRealComponent};
