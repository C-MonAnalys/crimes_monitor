import{v}from"./chunk-GOJ2ZNOE.js";import{R as h,V as f,a as u,b as g,f as c}from"./chunk-QQS62GLD.js";var b=class p{constructor(r){this.http=r;let a=document.getElementsByTagName("base")[0],i=a&&a.getAttribute("href")||"/";this.base=i.endsWith("/")?`${i}assets/data/events`:`${i}/assets/data/events`}base;fetchJson(r){return c(this,null,function*(){try{let a=yield fetch(`${this.base}/${r}`);return a.ok?a.json():null}catch(a){return console.error("fetchJson error",r,a),null}})}listAll(){return c(this,null,function*(){let[r,a,i]=yield Promise.all([this.fetchJson("metrics_comparison.json"),this.fetchJson("videos_2024_onwards.json"),this.fetchJson("videos_pre_2024.json")]),s=[];Array.isArray(i)&&s.push(...i),Array.isArray(a)&&s.push(...a);let e=s.map(l=>{let d=l.data_postagem??l.date??l.day??null,o=null;if(d)try{o=new Date(d),isNaN(o.getTime())&&(o=null)}catch{o=null}return g(u({},l),{data_postagem:d,parsedDate:o})}).filter(l=>l.parsedDate),n=this.aggregateByPeriod(e,"month"),y=this.aggregateByPeriod(e,"year");return{videos:e,metrics:Array.isArray(r)?r:[],videosByMonth:n,videosByYear:y}})}aggregateByPeriod(r,a){let i={};for(let s of r){if(!s.parsedDate)continue;let e;a==="month"?e=`${s.parsedDate.getFullYear()}-${String(s.parsedDate.getMonth()+1).padStart(2,"0")}`:e=String(s.parsedDate.getFullYear()),i[e]=(i[e]||0)+1}return Object.entries(i).map(([s,e])=>({period:s,count:e})).sort((s,e)=>s.period.localeCompare(e.period))}getAllVideos(){return c(this,null,function*(){return(yield this.listAll()).videos})}getMetrics(){return c(this,null,function*(){return(yield this.listAll()).metrics})}getVideosByMonth(){return c(this,null,function*(){return(yield this.listAll()).videosByMonth})}getVideosByYear(){return c(this,null,function*(){return(yield this.listAll()).videosByYear})}getEventsRaw(){return this.http.get("assets/data/events.json")}getEventsTimeSeries(){return this.http.get("assets/data/events_timeseries.json")}getEvaluationsOverview(){return c(this,null,function*(){let{videos:r,metrics:a,videosByYear:i}=yield this.listAll(),s=r?.length??0,e=r?new Set(r.map(t=>t.operation_id||t.operation||t.op)).size:0,n=(r??[]).map(t=>t.parsedDate?.getFullYear?.()).filter(t=>typeof t=="number"&&!isNaN(t)),y=n.length?`${Math.min(...n)}\u2013${Math.max(...n)}`:"\u2014",l=e?+(s/e).toFixed(1):0,d=Array.isArray(a)&&a.length?a.map(t=>({label:t.label??t.nome??t.tech??"T\xE9cnica",metrics:{accuracy:t.accuracy??t.acuracia??0,precision:t.precision??0,recall:t.recall??t.revocacao??0,f1:t.f1??0}})):[],o={labels:(i??[]).map(t=>t.period),values:(i??[]).map(t=>t.count)};return{datasets:{totalVideos:s,uniqueOperations:e,periodLabel:y,avgVideosPerOperation:l},performance:d,videosByPeriod:o}})}buildSeriesFromRaw(r){let a={};(r.videos??r).forEach(e=>{let n=new Date(e.date||e.created_at||e.timestamp).getFullYear();isNaN(n)||(a[n]=(a[n]||0)+1)});let i=Object.keys(a).sort(),s=i.map(e=>a[+e]);return{labels:i,values:s}}getOperationVideos(r){return c(this,null,function*(){let{videos:a}=yield this.listAll(),i=String(r).trim().toLowerCase();return a.filter(s=>{let e=(s.operation_id??s.operation??s.op??"").toString().trim().toLowerCase();return e&&e===i})})}getOperationOverview(r){return c(this,null,function*(){let a=yield this.getOperationVideos(r),i=a.length,s={},e=null,n=null;for(let o of a){let t=o.parsedDate??(o.data_postagem?new Date(o.data_postagem):null);if(!t||isNaN(t.getTime()))continue;let m=t.toISOString().slice(0,10);s[m]=(s[m]||0)+1,(!e||t<e)&&(e=t),(!n||t>n)&&(n=t)}let y=Object.keys(s).sort(),l=y.map(o=>s[o]),d=e&&n?`${e.toISOString().slice(0,10)} \u2013 ${n.toISOString().slice(0,10)}`:"\u2014";return{opId:String(r),totalVideos:i,periodLabel:d,videosByDay:{labels:y,values:l}}})}static \u0275fac=function(a){return new(a||p)(f(v))};static \u0275prov=h({token:p,factory:p.\u0275fac,providedIn:"root"})};export{b as a};
