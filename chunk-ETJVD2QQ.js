import{j as T,o as $,v as P}from"./chunk-GOJ2ZNOE.js";import{Aa as u,Ab as S,La as B,Qa as R,R as F,V as E,bb as j,cb as f,db as g,eb as k,f as b,ub as A,yb as h,zb as M}from"./chunk-QQS62GLD.js";var N=class p{constructor(e){this.http=e;let t=document.getElementsByTagName("base")[0],s=t&&t.getAttribute("href")||"/";this.base=s.endsWith("/")?`${s}assets/data/sentiment`:`${s}/assets/data/sentiment`}base;fetchJson(e){return b(this,null,function*(){try{let t=yield fetch(`${this.base}/${e}`);return t.ok?t.json():null}catch(t){return console.error("SentimentService.fetchJson error",e,t),null}})}getDatasets(){return b(this,null,function*(){return this.fetchJson("datasets.json")})}loadDataset(e){return b(this,null,function*(){let t=yield this.getDatasets();if(!t||!t[e])throw new Error(`Dataset com o ID '${e}' n\xE3o foi encontrado.`);let s=t[e],n=s.bootstrapFile,r=s.commentsFile;if(!n||!r)throw new Error(`Configura\xE7\xE3o de ficheiros incompleta para o dataset '${e}'.`);let i=n.replace("data/",""),a=r.replace("data/",""),[l,c]=yield Promise.all([this.fetchJson(i),this.fetchJson(a)]);return{bootstrap:Array.isArray(l)?l:[],comments:Array.isArray(c)?c:[]}})}listAll(){return b(this,null,function*(){let[e,t,s]=yield Promise.all([this.fetchJson("datasets.json"),this.fetchJson("bootstrap_results_211124.json"),this.fetchJson("comentarios_2021_nordeste_newBERT.json")]);return{datasets:e??{},bootstrap:Array.isArray(t)?t:[],comments:Array.isArray(s)?s:[]}})}getTrainingStats(){return b(this,null,function*(){let e=document.getElementsByTagName("base")[0],t=e&&e.getAttribute("href")||"/",s=t.endsWith("/")?t:t+"/",n=`${s}assets/data/sentiment/treinamento_model_211124.json`,r=`${s}assets/data/sentiment/bootstrap_results_211124.json`,i=[];try{let o=yield fetch(n);o.ok&&(i=yield o.json())}catch(o){console.warn("[SentimentService.getTrainingStats] Falha ao ler treino \xFAnico:",o)}if(!Array.isArray(i)||!i.length)try{let[o,m]=yield Promise.all([this.http.get("assets/data/sentiment/train_labels.json").toPromise(),this.http.get(r).toPromise()]);return{total:Object.values(o||{}).reduce((x,I)=>x+I,0)||0,period:"\u2014",labels:o||{"-1":0,0:0,1:0},bootstrap:m||[],quality:{avgLen:0,medianLen:0,pShort:0}}}catch(o){return console.warn("[SentimentService.getTrainingStats] Fallback antigo indispon\xEDvel:",o),{total:0,period:"\u2014",labels:{"-1":0,0:0,1:0},bootstrap:[],quality:{avgLen:0,medianLen:0,pShort:0}}}let a={"-1":0,0:0,1:0},l=[],c=0;for(let o of i){let m=String(o?.rotulo??"0");a[m]===void 0&&(a[m]=0),a[m]++;let C=(o?.comentario??"").trim().length;l.push(C),C<30&&c++}let d=i.length,y=d?Math.round(l.reduce((o,m)=>o+m,0)/d):0,w=(()=>{let o=l.slice().sort((C,x)=>C-x);if(!o.length)return 0;let m=Math.floor(o.length/2);return o.length%2?o[m]:Math.round((o[m-1]+o[m])/2)})(),v=d?Math.round(c/d*100):0,_=[];try{let o=yield fetch(r);o.ok&&(_=yield o.json())}catch(o){console.warn("[SentimentService.getTrainingStats] Bootstrap indispon\xEDvel:",o)}return{total:d,period:"\u2014",labels:a,bootstrap:Array.isArray(_)?_:[],quality:{avgLen:y,medianLen:w,pShort:v}}})}getSentimentCounts(e){let t={"-1":0,0:0,1:0};for(let s of e){let n=String(s.new_BERT??"0");t[n]===void 0&&(t[n]=0),t[n]++}return t}toNum(e){if(e==null)return 0;if(typeof e=="number")return e>1.0001?e/100:e;let t=String(e).trim().replace(",",".");if(t.endsWith("%")){let n=parseFloat(t.slice(0,-1));return isNaN(n)?0:n/100}let s=parseFloat(t);return isNaN(s)?0:s>1.0001?s/100:s}parseCsv(e){let t=e.split(/\r?\n/).filter(r=>r.trim().length);if(!t.length)return[];let s=t[0].split(",").map(r=>r.trim()),n=[];for(let r=1;r<t.length;r++){let i=t[r].split(",");if(i.length!==s.length)continue;let a={};s.forEach((l,c)=>a[l]=(i[c]??"").trim()),n.push(a)}return n}normalizeModelRows(e){let t=(n,r)=>{for(let i of r){let a=n[i];if(a!=null)return String(a).trim()}return""},s=(n,r)=>{for(let i of r){let a=n[i];if(a!=null)return this.toNum(a)}return 0};return e.map(n=>{let r=t(n,["","Metric","metric","Unnamed: 0"]);if(!r){let c=t(n,["metric","Metric"]).toLowerCase(),d=t(n,["class","Class","classe","Classe"]);c&&d!==""&&(r=`${c}_class_${d}`)}let i=s(n,["mean"]),a=s(n,["lower_95_ci","lower_ci","lower"]),l=s(n,["upper_95_ci","upper_ci","upper"]);return{key:r,mean:i,lower:a,upper:l}}).filter(n=>n.key)}extractByMetricKey(e){let t=/^(precision|recall|f1)[\s_-]class[\s_-](\d+)/i,s={precision:[],recall:[],f1:[]};for(let n of e){let r=n.key.match(t);if(!r)continue;let i=r[1].toLowerCase(),a=Number(r[2]);s[i].push({class:a,mean:n.mean,lower:n.lower,upper:n.upper})}return["precision","recall","f1"].forEach(n=>{let r={};s[n].forEach(i=>r[i.class]=i),s[n]=[0,1,2].map(i=>r[i]??{class:i,mean:0,lower:0,upper:0})}),s}getBootstrapComparisons(){return b(this,null,function*(){let e=document.getElementsByTagName("base")[0],t=e&&e.getAttribute("href")||"/",s=t.endsWith("/")?t:t+"/",n=`${s}assets/data/sentiment/bootstrap_results_211124.json`,r=`${s}assets/data/sentiment/bootstrap/index.json`,i=[];try{let a=yield fetch(n);if(a.ok){let l=yield a.json(),c=this.normalizeModelRows(l),d=this.extractByMetricKey(c);i.push({model:"BERTimbau",metrics:d})}}catch(a){console.warn("[getBootstrapComparisons] baseline JSON indispon\xEDvel:",a)}try{let a=yield fetch(r);if(a.ok){let l=yield a.json();for(let c of l){let d=`${s}assets/data/sentiment/bootstrap/${c.file}`;try{let y=c.file.toLowerCase().endsWith(".json"),w=[],v=yield fetch(d);if(!v.ok)continue;if(y){let o=yield v.json();w=this.normalizeModelRows(o)}else{let o=yield v.text(),m=this.parseCsv(o);w=this.normalizeModelRows(m)}let _=this.extractByMetricKey(w);i.push({model:c.label||c.file,metrics:_})}catch(y){console.warn("[getBootstrapComparisons] falha ao ler",c.file,y)}}}}catch{}return i})}static \u0275fac=function(t){return new(t||p)(E(P))};static \u0275prov=F({token:p,factory:p.\u0275fac,providedIn:"root"})};function D(p,e){if(p&1&&(f(0,"div",8)(1,"div",9),h(2),g(),f(3,"div",10),k(4,"div",11)(5,"div",12),g(),f(6,"div",13)(7,"span"),h(8),g(),f(9,"strong",14),h(10),g(),f(11,"span"),h(12),g()()()),p&2){let t=e.$implicit;u(2),S("Classe ",t.class),u(2),A("left",t.lower_ci*100,"%")("width",(t.upper_ci-t.lower_ci)*100,"%"),u(),A("left",t.mean*100,"%"),u(3),S("",(t.lower_ci*100).toFixed(1),"%"),u(2),S("",(t.mean*100).toFixed(1),"%"),u(2),S("",(t.upper_ci*100).toFixed(1),"%")}}function O(p,e){if(p&1&&(f(0,"div",4)(1,"h4",5),h(2),g(),f(3,"div",6),R(4,D,13,10,"div",7),g()()),p&2){let t=e.$implicit;u(2),M(t.metric),u(2),j("ngForOf",t.items)}}var J=class p{groups=[];static \u0275fac=function(t){return new(t||p)};static \u0275cmp=B({type:p,selectors:[["app-bootstrap-results-card"]],hostAttrs:[1,"block"],inputs:{groups:"groups"},decls:5,vars:1,consts:[[1,"bg-white","rounded-lg","shadow-sm","border","border-slate-200","p-6"],[1,"text-lg","font-semibold","text-slate-900","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],["class","border border-slate-200 rounded-lg p-4",4,"ngFor","ngForOf"],[1,"border","border-slate-200","rounded-lg","p-4"],[1,"font-semibold","text-slate-900","mb-3","capitalize"],[1,"space-y-3"],["class","space-y-2",4,"ngFor","ngForOf"],[1,"space-y-2"],[1,"text-sm","text-slate-600"],[1,"relative","bg-slate-100","h-4","rounded-full"],[1,"absolute","h-full","bg-blue-200","rounded-full"],[1,"absolute","w-0.5","h-full","bg-blue-600"],[1,"flex","justify-between","text-xs","text-slate-500"],[1,"text-slate-700"]],template:function(t,s){t&1&&(f(0,"div",0)(1,"h3",1),h(2,"Resultados Bootstrap (Intervalos de Confian\xE7a)"),g(),f(3,"div",2),R(4,O,5,2,"div",3),g()()),t&2&&(u(4),j("ngForOf",s.groups))},dependencies:[$,T],encapsulation:2})};export{N as a,J as b};
