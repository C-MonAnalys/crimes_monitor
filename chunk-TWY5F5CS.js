import{a as V,b as Z,c as q,d as H,e as Q}from"./chunk-RTC6WHHT.js";import{a as z}from"./chunk-IQRRAYZG.js";import{a as K,b as J}from"./chunk-ETJVD2QQ.js";import{h as D}from"./chunk-Q67L2CHF.js";import{l as U,m as M}from"./chunk-MWBKWIFM.js";import{d as W,j as $}from"./chunk-IAGVYY6L.js";import{i as j,j as _,k as G,o as f}from"./chunk-GOJ2ZNOE.js";import{Aa as i,Ab as b,Bb as L,Fa as N,La as d,Lb as P,Qa as h,bb as r,cb as l,db as s,eb as p,f as R,fb as u,gb as g,hb as k,ob as C,ub as B,yb as a,zb as x}from"./chunk-QQS62GLD.js";var w=class o{chartData;static \u0275fac=function(e){return new(e||o)};static \u0275cmp=d({type:o,selectors:[["app-temporal-evolution-chart"]],hostAttrs:[1,"block"],inputs:{chartData:"chartData"},decls:8,vars:0,consts:[[1,"bg-white","rounded-lg","shadow-sm","border","border-slate-200","p-6"],[1,"text-lg","font-semibold","text-slate-900","mb-4"],[1,"h-64","bg-slate-50","rounded-lg","flex","items-center","justify-center","text-slate-500"],[1,"text-center"],[1,"bi","bi-graph-up","text-4xl","mb-2"]],template:function(e,t){e&1&&(u(0,"div",0)(1,"h3",1),a(2,"Evolu\xE7\xE3o Temporal dos Posicionamentos"),g(),u(3,"div",2)(4,"div",3),k(5,"i",4),u(6,"p"),a(7,"Gr\xE1fico de linha mostrando evolu\xE7\xE3o dos posicionamentos ao longo do tempo"),g()()()())},dependencies:[f],encapsulation:2})};var I=class o{data;options;static \u0275fac=function(e){return new(e||o)};static \u0275cmp=d({type:o,selectors:[["app-metrics-bar-chart"]],inputs:{data:"data",options:"options"},decls:5,vars:2,consts:[[1,"bg-white","rounded-lg","shadow-sm","border","border-slate-200","p-6","h-full","flex","flex-col"],[1,"text-lg","font-semibold","text-slate-900","mb-4"],[1,"relative","flex-grow"],["type","bar","height","100%",3,"data","options"]],template:function(e,t){e&1&&(l(0,"div",0)(1,"h3",1),a(2,"M\xE9tricas por T\xE9cnica"),s(),l(3,"div",2),p(4,"p-chart",3),s()()),e&2&&(i(4),r("data",t.data)("options",t.options))},dependencies:[f,M,U],encapsulation:2})};function ee(o,n){if(o&1&&(l(0,"div",4)(1,"h4",5),a(2),s(),l(3,"div",6)(4,"div",7)(5,"div",8)(6,"span"),a(7,"M\xE9dia (Mean)"),s(),l(8,"span",9),a(9),s()(),l(10,"div",10),p(11,"div",11),s()(),l(12,"div",12)(13,"span"),a(14),s()()()()),o&2){let e=n.$implicit;i(2),x(e[""]),i(7),b("",(e.mean*100).toFixed(1),"%"),i(2),B("width",e.mean*100,"%"),i(3),L("95% CI: [",(e.lower_95_ci*100).toFixed(1),"% - ",(e.upper_95_ci*100).toFixed(1),"%]")}}var A=class o{allMetrics=[];static \u0275fac=function(e){return new(e||o)};static \u0275cmp=d({type:o,selectors:[["app-detailed-metrics-card"]],hostAttrs:[1,"block"],inputs:{allMetrics:"allMetrics"},decls:5,vars:1,consts:[[1,"bg-white","rounded-lg","shadow-sm","border","border-slate-200","p-6"],[1,"text-lg","font-semibold","text-slate-900","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4","w-full"],["class","border border-slate-200 rounded-lg p-4 bg-slate-50",4,"ngFor","ngForOf"],[1,"border","border-slate-200","rounded-lg","p-4","bg-slate-50"],[1,"font-semibold","text-slate-900","capitalize","mb-2"],[1,"space-y-3"],[1,"space-y-1"],[1,"flex","justify-between","text-sm"],[1,"font-medium"],[1,"w-full","bg-slate-200","rounded-full","h-2"],[1,"bg-blue-500","h-2","rounded-full"],[1,"text-xs","text-slate-500","text-center"]],template:function(e,t){e&1&&(l(0,"div",0)(1,"h3",1),a(2,"M\xE9tricas de Confian\xE7a (Bootstrap)"),s(),l(3,"div",2),h(4,ee,15,6,"div",3),s()()),e&2&&(i(4),r("ngForOf",t.allMetrics))},dependencies:[f,_,D],encapsulation:2})};var te=(o,n,e)=>({"border-l-red-500 bg-red-50":o,"border-l-yellow-500 bg-yellow-50":n,"border-l-green-500 bg-green-50":e}),ne=(o,n,e)=>({"bg-red-100 text-red-800":o,"bg-yellow-100 text-yellow-800":n,"bg-green-100 text-green-800":e});function oe(o,n){if(o&1&&(l(0,"div",4)(1,"div",5)(2,"span",6),a(3),s(),l(4,"span",7),a(5),s()(),l(6,"p",8),a(7),s(),l(8,"div",9)(9,"span"),a(10),s(),l(11,"span"),a(12),s()()()),o&2){let e=n.$implicit,t=C();r("ngClass",P(7,te,e.new_BERT===-1,e.new_BERT===0,e.new_BERT===1)),i(2),r("ngClass",P(11,ne,e.new_BERT===-1,e.new_BERT===0,e.new_BERT===1)),i(),b(" ",t.getSentimentLabel(e.new_BERT)," "),i(2),x(t.formatDate(e.timestamp)),i(2),x(e.comentario),i(3),b("Canal: ",e.canal),i(2),b("",e.curtidas," curtidas")}}var T=class o{comments=[];getSentimentLabel(n){switch(n){case-1:return"Desaprova\xE7\xE3o";case 0:return"Neutro";case 1:return"Aprova\xE7\xE3o";default:return"Indefinido"}}formatDate(n){try{return new Date(n).toLocaleDateString("pt-BR")}catch{return n}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=d({type:o,selectors:[["app-comments-sample-card"]],hostAttrs:[1,"block"],inputs:{comments:"comments"},decls:5,vars:1,consts:[[1,"bg-white","rounded-lg","shadow-sm","border","border-slate-200","p-6"],[1,"text-lg","font-semibold","text-slate-900","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["class","border rounded-lg p-4 border-l-4",3,"ngClass",4,"ngFor","ngForOf"],[1,"border","rounded-lg","p-4","border-l-4",3,"ngClass"],[1,"flex","justify-between","items-center","mb-2"],[1,"px-2","py-1","rounded","text-xs","font-medium",3,"ngClass"],[1,"text-xs","text-slate-500"],[1,"text-sm","text-slate-700","mb-2","line-clamp-3"],[1,"flex","justify-between","text-xs","text-slate-500"]],template:function(e,t){e&1&&(l(0,"div",0)(1,"h3",1),a(2,"Amostra de Coment\xE1rios Analisados"),s(),l(3,"div",2),h(4,oe,13,15,"div",3),s()()),e&2&&(i(4),r("ngForOf",t.comments))},dependencies:[f,j,_],encapsulation:2})};var F=class o{precision=0;recall=0;f1Score=0;static \u0275fac=function(e){return new(e||o)};static \u0275cmp=d({type:o,selectors:[["app-model-accuracy-card"]],hostAttrs:[1,"block"],inputs:{precision:"precision",recall:"recall",f1Score:"f1Score"},decls:19,vars:3,consts:[[1,"bg-white","rounded-lg","shadow-sm","border","border-slate-200","p-6"],[1,"text-lg","font-semibold","text-slate-900","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"text-center","p-4","bg-slate-50","rounded-lg"],[1,"text-xl","font-bold","text-blue-600"],[1,"text-sm","text-slate-600"],[1,"text-xl","font-bold","text-green-600"],[1,"text-xl","font-bold","text-purple-600"]],template:function(e,t){e&1&&(u(0,"div",0)(1,"h3",1),a(2,"Precis\xE3o do Modelo BERT"),g(),u(3,"div",2)(4,"div",3)(5,"div",4),a(6),g(),u(7,"div",5),a(8,"Precis\xE3o Geral"),g()(),u(9,"div",3)(10,"div",6),a(11),g(),u(12,"div",5),a(13,"Recall"),g()(),u(14,"div",3)(15,"div",7),a(16),g(),u(17,"div",5),a(18,"F1-Score"),g()()()()),e&2&&(i(6),b("",t.precision,"%"),i(5),b("",t.recall,"%"),i(5),b("",t.f1Score,"%"))},dependencies:[f],encapsulation:2})};function ie(o,n){if(o&1&&p(0,"app-weekly-stacked-chart",15),o&2){let e=C();r("comments",e.comments)("bootstrapData",e.bootstrapStats)}}function ae(o,n){if(o&1&&p(0,"app-bootstrap-results-card",16),o&2){let e=C();r("groups",e.bootstrapGroups)}}function re(o,n){if(o&1&&p(0,"app-detailed-metrics-card",17),o&2){let e=C();r("allMetrics",e.metrics)}}function se(o,n){if(o&1&&p(0,"app-comments-sample-card",18),o&2){let e=C();r("comments",e.sampleComments)}}var Y=class o{constructor(n,e){this.sentimentService=n;this.route=e}modelAccuracy={precision:0,recall:0,f1Score:0};totalComments=0;sentimentCounts={"-1":0,0:0,1:0};sentimentPercentages={negative:0,neutral:0,positive:0};topicCounts={security:0,violence:0,police:0,management:0};isLoading=!0;metrics=[];sentimentChartData={};sentimentChartOptions={};metricsChartData={};metricsChartOptions={};bootstrapStats=[];bootstrapGroups=[];sampleComments=[];datasetInfo={};comments=[];weeklyChartInputData=null;ngOnInit(){return R(this,null,function*(){this.route.paramMap.subscribe(n=>{let e=n.get("datasetId");e?this.loadAllData(e):(console.error("Nenhum ID de dataset foi fornecido na URL."),this.isLoading=!1)})})}loadAllData(n){return R(this,null,function*(){try{let e=yield this.sentimentService.loadDataset(n);if(this.comments=e.comments,this.totalComments=e.comments.length,this.sentimentCounts=this.sentimentService.getSentimentCounts(e.comments),this.totalComments>0){this.sentimentPercentages={negative:Math.round(this.sentimentCounts[-1]/this.totalComments*100),neutral:Math.round(this.sentimentCounts[0]/this.totalComments*100),positive:Math.round(this.sentimentCounts[1]/this.totalComments*100)},this.topicCounts={security:Math.floor(this.totalComments*.65),violence:Math.floor(this.totalComments*.45),police:Math.floor(this.totalComments*.38),management:Math.floor(this.totalComments*.22)};let t=e.comments.filter(m=>m.comentario&&m.comentario.length>50),c=t.filter(m=>m.new_BERT===1).slice(0,2),v=t.filter(m=>m.new_BERT===0).slice(0,2),y=t.filter(m=>m.new_BERT===-1).slice(0,2);this.sampleComments=[...c,...v,...y]}if(this.bootstrapStats=e.bootstrap,console.log("[PAI] Dados de bootstrap carregados do servi\xE7o:",this.bootstrapStats),this.bootstrapGroups=this.groupBootstrapResults(this.bootstrapStats),e.bootstrap){let t=Array.isArray(e.bootstrap)?e.bootstrap:Object.values(e.bootstrap);t&&t.length>0&&(this.metrics=t,this.calculateModelAccuracy(t))}this.prepareSentimentChart(),this.prepareMetricsChart(),this.weeklyChartInputData={comments:e.comments,bootstrapData:this.bootstrapStats}}catch(e){console.error("Erro ao carregar dados:",e)}finally{this.isLoading=!1}})}prepareSentimentChart(){this.sentimentChartData={labels:["Desaprova\xE7\xE3o","Neutro","Aprova\xE7\xE3o"],datasets:[{data:[this.sentimentPercentages.negative,this.sentimentPercentages.neutral,this.sentimentPercentages.positive],backgroundColor:["#ef4444","#6b7280","#10b981"],borderWidth:0}]},this.sentimentChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:n=>`${n.label}: ${n.parsed.toFixed(1)}%`}}}}}prepareMetricsChart(){if(this.metrics.length===0)return;let n=this.metrics.map(t=>t[""]||"M\xE9trica"),e=this.metrics.map(t=>t.mean||0);this.metricsChartData={labels:n,datasets:[{label:"M\xE9dia (Mean)",data:e,backgroundColor:"rgba(59, 130, 246, 0.7)",borderColor:"rgb(59, 130, 246)",borderWidth:1}]},this.metricsChartOptions={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!0,ticks:{callback:function(t){return typeof t=="number"&&t>=0&&t<=1?(t*100).toFixed(0)+"%":t}}},x:{ticks:{autoSkip:!1,maxRotation:90,minRotation:45}}}}}groupBootstrapResults(n){if(!n||n.length===0)return[];let e=n.reduce((t,c)=>{let v=c[""];if(!v)return t;let y=v.split("_class_"),m=y[0],O=y[1];return t[m]||(t[m]={metric:m,items:[]}),t[m].items.push({class:O,mean:c.mean,lower_ci:c.lower_95_ci,upper_ci:c.upper_95_ci}),t},{});return Object.values(e)}createBootstrapSummary(n){if(Array.isArray(n))return{count:n.length,avgScore:n.reduce((e,t)=>e+(t.score||0),0)/n.length||0};if(typeof n=="object"&&n!==null){let e=Object.values(n).filter(t=>typeof t=="number");return{count:e.length,avgScore:e.reduce((t,c)=>t+c,0)/e.length||0}}return{count:0,avgScore:0}}formatNumber(n){return n>=1e3?(n/1e3).toFixed(1)+"K":n.toString()}calculateModelAccuracy(n){let e=t=>{let c=n.filter(m=>m[""]&&m[""].startsWith(t));if(c.length===0)return 0;let y=c.reduce((m,O)=>m+O.mean,0)/c.length*100;return Math.round(y)};this.modelAccuracy={precision:e("precision_class_"),recall:e("recall_class_"),f1Score:e("f1_class_")}}static \u0275fac=function(e){return new(e||o)(N(K),N(W))};static \u0275cmp=d({type:o,selectors:[["app-opinion-analysis"]],decls:25,vars:34,consts:[[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"text-3xl","font-bold","text-slate-900"],[1,"text-slate-600","mt-2"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6"],[3,"label","value","icon","color","isLoading"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[3,"counts","percentages"],[3,"topicCounts"],[3,"comments","bootstrapData",4,"ngIf"],[3,"data","options"],[3,"groups",4,"ngIf"],[3,"allMetrics",4,"ngIf"],[3,"comments",4,"ngIf"],[3,"precision","recall","f1Score"],[3,"comments","bootstrapData"],[3,"groups"],[3,"allMetrics"],[3,"comments"]],template:function(e,t){e&1&&(l(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),a(4,"An\xE1lise de Posicionamento"),s(),l(5,"p",3),a(6,"An\xE1lise de opini\xF5es e posicionamentos da popula\xE7\xE3o sobre diversos assuntos"),s()()(),l(7,"div",4),p(8,"app-analysis-stat-card",5)(9,"app-analysis-stat-card",5)(10,"app-analysis-stat-card",5)(11,"app-analysis-stat-card",5),s(),l(12,"div",6),p(13,"app-positioning-distribution",7)(14,"app-topics-card",8),s(),h(15,ie,1,2,"app-weekly-stacked-chart",9),p(16,"app-temporal-evolution-chart"),l(17,"div",6),p(18,"app-positioning-doughnut-chart",10)(19,"app-metrics-bar-chart",10),s(),h(20,ae,1,1,"app-bootstrap-results-card",11)(21,re,1,1,"app-detailed-metrics-card",12)(22,se,1,1,"app-comments-sample-card",13),p(23,"app-model-accuracy-card",14),s(),p(24,"app-footer")),e&2&&(i(8),r("label","Opini\xF5es Analisadas")("value",t.formatNumber(t.totalComments))("icon","bi-chat-text")("color","blue")("isLoading",t.isLoading),i(),r("label","Aprova\xE7\xE3o")("value",t.sentimentPercentages.positive+"%")("icon","bi-emoji-smile")("color","green")("isLoading",t.isLoading),i(),r("label","Desaprova\xE7\xE3o")("value",t.sentimentPercentages.negative+"%")("icon","bi-emoji-frown")("color","red")("isLoading",t.isLoading),i(),r("label","Neutro")("value",t.sentimentPercentages.neutral+"%")("icon","bi-emoji-neutral")("color","yellow")("isLoading",t.isLoading),i(2),r("counts",t.sentimentCounts)("percentages",t.sentimentPercentages),i(),r("topicCounts",t.topicCounts),i(),r("ngIf",t.comments.length>0),i(3),r("data",t.sentimentChartData)("options",t.sentimentChartOptions),i(),r("data",t.metricsChartData)("options",t.metricsChartOptions),i(),r("ngIf",t.bootstrapGroups.length>0),i(),r("ngIf",t.metrics.length>0),i(),r("ngIf",t.sampleComments.length>0),i(),r("precision",t.modelAccuracy.precision)("recall",t.modelAccuracy.recall)("f1Score",t.modelAccuracy.f1Score))},dependencies:[f,G,$,D,M,V,Z,q,w,H,I,J,A,T,F,Q,z],encapsulation:2})};export{Y as a};
