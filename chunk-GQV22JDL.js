import{L as D}from"./chunk-OAMJKMOZ.js";import{a as h,b as v,f as b}from"./chunk-EQDQRRRY.js";var w=class g{base;constructor(){let t=document.getElementsByTagName("base")[0],e=t&&t.getAttribute("href")||"/",s=e.endsWith("/")?e:e+"/";this.base=`${s}assets/data/events/cenario-real`}fetchJson(t){return b(this,null,function*(){try{let e=yield fetch(t);if(!e.ok)throw new Error(`HTTP ${e.status}`);return e.json()}catch(e){throw console.error("[EventsRealService] fetchJson error:",t,e),e}})}getDatasets(){return b(this,null,function*(){let t=`${this.base}/datasets.json`;return(yield this.fetchJson(t))??{}})}loadDataset(t){return b(this,null,function*(){let e=yield this.getDatasets(),s=e[t];if(!s)throw new Error(`Dataset "${t}" n\xE3o encontrado em datasets.json`);let n=[];if(s.file==="__ALL__"){let d=Object.values(e).map(r=>r.file).filter(r=>r&&r!=="__ALL__").map(r=>this.fetchJson(this.resolveAssetUrl(r)).catch(p=>(console.error("[EventsRealService] erro ao buscar arquivo",r,p),null)));if(n=(yield Promise.all(d)).filter(r=>Array.isArray(r)).flat(),!n.length)throw new Error("Nenhum arquivo dispon\xEDvel para compilar datasets.")}else{let u=this.resolveAssetUrl(s.file);n=yield this.fetchJson(u)}let a=this.normalizeVideos(n),{byYear:o,byDay:l,period:y,opCount:c}=this.aggregate(a);return{meta:{id:t,label:s.label,description:s.description,period:y,totalVideos:a.length,totalOperations:c},videos:a,series:{byYear:o,byDay:l}}})}resolveAssetUrl(t){return t.startsWith("events/")?`${this.base.replace("/cenario-real","")}/${t.replace(/^events\//,"")}`:`${this.base}/${t}`}normalizeVideos(t){return Array.isArray(t)?t.map(e=>{let s=e.data_postagem||e.date||e.day||null,n=null;if(s){let o=new Date(s);n=isNaN(o.getTime())?null:o}let a=(e.operation_ner??e.operation??e.op??"").toString().trim();return v(h({},e),{parsedDate:n,operation_id:a})}).filter(e=>!!e.parsedDate):[]}aggregate(t){let e={},s={},n=new Set,a=null,o=null;for(let i of t){let r=i.parsedDate,p=String(r.getUTCFullYear()),f=r.toISOString().slice(0,10);e[p]=(e[p]||0)+1,s[f]=(s[f]||0)+1;let m=(i.operation_id||"").toString().trim();m&&n.add(m),(!a||r<a)&&(a=r),(!o||r>o)&&(o=r)}let l=Object.keys(e).sort(),y=l.map(i=>e[i]),c=Object.keys(s).sort(),u=c.map(i=>s[i]),d=a&&o?`${a.toISOString().slice(0,10)} \u2013 ${o.toISOString().slice(0,10)}`:"\u2014";return{byYear:{labels:l,values:y},byDay:{labels:c,values:u},period:d,opCount:n.size}}static \u0275fac=function(e){return new(e||g)};static \u0275prov=D({token:g,factory:g.\u0275fac,providedIn:"root"})};export{w as a};
