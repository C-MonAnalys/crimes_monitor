<div class="space-y-6">
  <header class="bg-white rounded-xl border border-slate-200 p-6">
    <h1 class="text-2xl font-bold text-slate-900">
      Eventos
      <span class="text-slate-600 text-base ml-2" *ngIf="meta?.label">({{ meta.label }})</span>
    </h1>
    <p class="text-slate-600 mt-1">Eventos detectados pela heurística no dataset selecionado.</p>
  </header>

  <div class="bg-white rounded-xl border border-slate-200 p-6" *ngIf="isLoading">Carregando…</div>
  <div class="bg-white rounded-xl border border-slate-200 p-6 text-red-600" *ngIf="!isLoading && error">{{ error }}</div>
  <div *ngIf="timedOut && !error" class="bg-amber-50 border border-amber-200 text-amber-700 rounded-md p-3">Conexão lenta. Exibindo o que já foi carregado…</div>

  <ng-container *ngIf="!isLoading && !error">
    

    <!-- GRÁFICO: Eventos por período -->
    <section class="bg-white rounded-xl border border-slate-200 p-6">
      <app-eventos-timeline-chart
        [videos]="videos"
        [datasetId]="meta?.id">
      </app-eventos-timeline-chart>
    </section>

    <!-- Cards -->
    <section class="flex justify-center">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 w-full ">
        <div class="bg-white border border-slate-200 rounded-xl p-4">
          <div class="text-slate-500 text-sm">Total de Vídeos</div>
          <div class="text-2xl font-bold">{{ meta?.totalVideos | number }}</div>
        </div>
        <div class="bg-white border border-slate-200 rounded-xl p-4">
          <div class="text-slate-500 text-sm">Eventos</div>
          <div class="text-2xl font-bold">{{ meta?.totalOperations | number }}</div>
        </div>
        <div class="bg-white border border-slate-200 rounded-xl p-4">
          <div class="text-slate-500 text-sm">Período</div>
          <div class="text-2xl font-bold">{{ meta?.period || '—' }}</div>
        </div>
      </div>
    </section>


    <!-- Lista (amostra) -->
    <section class="bg-white rounded-xl border border-slate-200 p-6">
      <h2 class="font-semibold text-slate-900 mb-3">Vídeos</h2>
      <ng-container *ngIf="filteredVideos?.length; else noVideos">
        <div class="grid grid-cols-1 gap-4">
          <article *ngFor="let v of filteredVideos | slice:0:20" class="border border-slate-200 rounded-lg p-4">
            <div class="text-sm text-slate-500 mb-1">{{ v.data_postagem || (v.parsedDate ? (v.parsedDate | date:'yyyy-MM-dd HH:mm') : '—') }}</div>
            <div class="font-medium text-slate-800">{{ v.titulo || 'Sem título' }}</div>
            <div class="text-slate-500 text-sm truncate" title="{{ v.descricao || '' }}">{{ v.descricao || 'Sem descrição' }}</div>
            <div class="mt-2 text-sm">
              <span class="px-2 py-0.5 rounded bg-slate-100 text-slate-700">Operação: {{ v.operation_id || '—' }}</span>
            </div>
            <div class="mt-3">
              <a *ngIf="v.link || v.url" class="text-blue-600 hover:underline" [href]="v.link || v.url" target="_blank" rel="noopener">Abrir vídeo</a>
            </div>
          </article>
        </div>
      </ng-container>
      <ng-template #noVideos><div class="text-slate-500">Nenhum vídeo encontrado.</div></ng-template>
    </section>
  </ng-container>
</div>
